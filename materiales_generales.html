<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Agregar Material</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      min-height: 100vh;
      background-color: #f4f6f9;
    }
    .sidebar {
      width: 230px;
      background-color: #5a7f71;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
      position: fixed;
      top: 0; left: 0; height: 100%;
    }
    .sidebar h2 { text-align:center; font-size:22px; margin-bottom:18px;}
    .sidebar a { color: white; text-decoration: none; padding: 12px 20px; display:block; transition: background-color 0.2s; font-size: 16px; }
    .sidebar a:hover, .sidebar a.active { background-color: #4a6a5f; border-left: 4px solid #fff; }

    .content { margin-left:230px; padding:30px; width: calc(100% - 230px); }
    .content h1 { font-size:28px; color:#333; margin-bottom:14px; }
    .card { background-color: white; border-radius:10px; padding:20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); }

    .form-row { display:flex; gap:12px; flex-wrap:wrap; }
    .form-row .form-group { flex:1 1 200px; }
    .btn-submit { background-color:#5a7f71; color:white; border:none; padding:8px 14px; border-radius:6px; }
    .btn-submit:hover { background-color:#46695c; }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Gestor de Obra</h2>
    <a href="materiales.html">üìã Materiales</a>
    <a href="materiales_generales.html" class="active">‚ûï Agregar material</a>
    <a href="cotizacion.html">üí∞ Hacer cotizaci√≥n</a>
    <a href="registro.html">üìù Registro</a>
    <a href="estadisticas.html">üìä Estad√≠sticas</a>
    <a href="facturacion.html">üßæ Facturaci√≥n</a>
    <a href="proyectos.html">üèóÔ∏è Proyectos</a>
    <a href="clientes.html">üë• Clientes y Proveedores</a>
  </div>

  <div class="content">
    <h1>Agregar Nuevo Material</h1>
    <div class="card">
      <form id="formAgregar">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre</label>
            <input id="nombre" name="nombre" class="form-control" required placeholder="Ej: Cemento 42.5kg">
          </div>
          <div class="form-group">
            <label for="unidad">Unidad</label>
            <input id="unidad" name="unidad" class="form-control" required placeholder="Ej: und, kg, m2">
          </div>
          <div class="form-group">
            <label for="precio">Precio unitario</label>
            <input id="precio" name="precio" type="number" step="0.01" class="form-control" required placeholder="Ej: 32000">
          </div>
        </div>

        <div style="margin-top:16px;">
          <button type="submit" class="btn-submit">Agregar Material</button>
          <button type="button" class="btn btn-secondary ms-2" onclick="window.location.href='materiales.html'">Volver a lista</button>
        </div>

        <div id="msg" style="margin-top:12px;"></div>
      </form>
    </div>
  </div>

  <script>
    const BASE = 'http://localhost:3000';
    const form = document.getElementById('formAgregar');
    const msg = document.getElementById('msg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      const nombre = document.getElementById('nombre').value.trim();
      const unidad = document.getElementById('unidad').value.trim();
      const precioRaw = document.getElementById('precio').value.trim();
      const precio = parseFloat(precioRaw);

      if (!nombre || !unidad || isNaN(precio)) {
        msg.innerHTML = '<div class="text-danger">Por favor complete todos los campos correctamente.</div>';
        return;
      }

      try {
        const res = await fetch(`${BASE}/agregar-material`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nombre, unidad, precio })
        });
        if (!res.ok) {
          const txt = await res.text().catch(()=>null);
          throw new Error('HTTP ' + res.status + ' ' + (txt || ''));
        }
        const data = await res.json().catch(()=>null);
        msg.innerHTML = '<div class="text-success">Material agregado correctamente.</div>';
        // redirigir a la lista de materiales despu√©s de 1s para que el usuario vea el mensaje
        setTimeout(() => window.location.href = 'materiales.html', 900);
      } catch (err) {
        console.error('Error al agregar material:', err);
        msg.innerHTML = '<div class="text-danger">Error al agregar el material. Revisa la consola del servidor.</div>';
      }
    });
  </script>

</body>
</html>
